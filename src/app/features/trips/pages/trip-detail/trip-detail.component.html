<!-- src/app/features/trips/pages/trip-detail/trip-detail.component.html -->
<div class="h-full overflow-y-auto w-full hide-scrollbar py-4 lg:py-0">
  @if (isPending(); as pendingMessage) {
    <!-- Loading state -->
    <div class="flex flex-col gap-4 items-center justify-center h-full">
      <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"></div>
      <p class="text-gray-500">{{ pendingMessage }}...</p>
    </div>
  } @else if (trip(); as tripInfo) {
    <!-- Trip content -->
    <div class="h-full flex flex-col gap-4 md:gap-6 w-full">
      <!-- SECCIÓN 1: Header con nombre, ubicación, fechas y acciones -->
      <div class="seccion-1 flex flex-col md:flex-row items-start justify-center gap-4">
        <!-- Nombre del viaje, ciudad, país y fechas -->
        <div class="flex-1">
          <div class="flex flex-col sm:flex-row items-baseline sm:gap-3 mb-2">
            <h3 class="max-w-70 text-2xl sm:text-3xl font-medium text-gray-900">
              {{ tripInfo.name }}
            </h3>
            <span class="text-sm text-gray-500">{{ tripInfo.city }}, {{ tripInfo.country }}</span>
          </div>

          <div class="w-full">
            <p class="text-sm text-gray-600">
            {{ tripInfo.start_date | date: 'dd MMM yyyy' }} -
            {{ tripInfo.end_date | date: 'dd MMM yyyy' }}
            ({{ tripDuration() }} días)
          </p>
        </div>
      </div>

      <!-- Botones de acción alineados a la derecha -->
      @if (isOwner()) {
      <div
        class="flex w-full md:w-auto justify-center md:justify-end gap-3 static lg:absolute right-3 top-3"
      >
        <!-- Botones para el owner -->
        <button
          type="button"
          (click)="editTrip()"
          class="flex w-full md:w-auto justify-center gap-4 items-center p-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors font-medium cursor-pointer"
          title="Editar viaje"
        >
          <i class="pi pi-pen-to-square" style="font-size: 1rem"></i>
          <span class="sm:hidden">Editar</span>
        </button>
        <button
          type="button"
          (click)="deleteTrip($event)"
          class="flex w-full md:w-auto justify-center gap-4 items-center p-2 bg-white border border-red-300 text-red-600 rounded-lg hover:bg-red-100 transition-colors font-medium cursor-pointer"
          title="Eliminar viaje"
        >
          <i class="pi pi-trash" style="font-size: 1rem"></i>
          <span class="sm:hidden">Eliminar</span>
        </button>
      </div>
      <p-confirmpopup />
      } @else {
      <!-- Botón para participantes no-owner -->
      <div class="w-full md:max-w-60">
        <button
          type="button"
          (click)="leaveTrip($event)"
          class="w-full flex items-center justify-center font-bold gap-2 px-4 py-2 bg-red-500 border border-gray-300 text-gray-900 rounded-lg hover:bg-red-100 hover:border-red-200 hover:text-red-500 transition-colors cursor-pointer"
          title="Salir del viaje"
        >
          <i class="pi pi-sign-out" style="font-size: 1.5rem"></i>
          <span class="text-sm md:text-lg">Abandonar viaje</span>
        </button>
      </div>
      }
    </div>

    <!-- SECCIÓN 2: Tres widgets (Participantes, Documentos, Checklist) -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
      <app-participant-widget [tripId]="trip()!.id" />
      <app-document-widget [tripId]="trip()!.id" />
      <app-checklist-widget [tripId]="trip()!.id" />
    </div>

    <!-- SECCIÓN 3: Pestañas (itinerary/gastos) -->
    <div class="flex-1 flex flex-col lg:overflow-hidden w-full">
      <!-- Pestañas estilo iOS picker -->
      <div class="relative bg-white rounded-xl shadow-sm border border-gray-200 p-2">
        <!-- Indicador deslizante (fondo) -->
        <div
          class="absolute inset-y-1 m-1 bg-black border border-gray-100 rounded-lg shadow-sm transition-all duration-300 ease-out"
          [style.width.%]="50"
          [style.left]="activeTab() === 'itinerary' ? '0.25rem' : 'calc(50% - 0.75rem)'"
        ></div>

        <!-- Contenedor de pestañas -->
        <div class="relative flex">
          <button
            type="button"
            (click)="activeTab.set('itinerary')"
            [class]="
              activeTab() === 'itinerary'
                ? 'flex-1 px-6 py-3 text-sm font-medium text-white transition-colors cursor-pointer relative z-10'
                : 'flex-1 px-6 py-3 text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors cursor-pointer relative z-10'
            "
          >
            <span class="flex items-center justify-center">
              <span>Itinerario</span>
            </span>
          </button>

          <button
            type="button"
            (click)="activeTab.set('expenses')"
            [class]="
              activeTab() === 'expenses'
                ? 'flex-1 px-6 py-3 text-sm font-medium text-white transition-colors cursor-pointer relative z-10'
                : 'flex-1 px-6 py-3 text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors cursor-pointer relative z-10'
            "
          >
            <span class="flex items-center justify-center">
              <span>Gastos</span>
            </span>
          </button>
        </div>
      </div>

      <!-- Contenido del tab activo -->
      <div class="flex-1 overflow-y-auto">
        @if (activeTab() === 'itinerary') {
        <app-itinerary-detail [tripId]="trip()!.id" />
        } @if (activeTab() === 'expenses') {
        <app-expenses [tripId]="trip()!.id" />
        }
      </div>
    </div>
  </div>
  } @else {
  <div class="flex flex-col gap-4 items-center justify-center h-full">
    <i class="pi pi-exclamation-circle text-2xl text-gray-500"></i>
    <p class="text-gray-500 text-center">
      No se ha cargado el viaje. <br />
      Por favor, inténtalo de nuevo más tarde.
    </p>
  </div>
  }

  <!-- Modales para los widgets -->
  @if (widgetModalService.type() === 'participants') {
  <app-widget-modal-wrapper title="Participantes">
    <app-participants-modal />
  </app-widget-modal-wrapper>
  } @if (widgetModalService.type() === 'documents') {
  <app-widget-modal-wrapper title="Documentos">
    <app-documents-modal />
  </app-widget-modal-wrapper>
  } @if (widgetModalService.type() === 'checklist') {
  <app-widget-modal-wrapper title="Checklist">
    <app-checklist-modal />
  </app-widget-modal-wrapper>
  } @if (itineraryModalService.isOpen()) {
  <app-itinerary-modal-wrapper />
  } @if (confirmModalService.isOpen()) {
  <app-confirm-modal (closed)="confirmModalService.close()"></app-confirm-modal>
  }
</div>
